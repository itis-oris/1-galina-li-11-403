<#import "base.ftlh" as layout>

<@layout.base pageTitle=event.title!"" + " - –î–µ—Ç–∞–ª–∏ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è">
    <div style="display: flex; justify-content: space-between; align-items: flex-start; gap: 2rem; margin-bottom: 2rem;">
        <div style="flex: 1;">
            <nav style="margin-bottom: 1rem;">
                <a href="${contextPath}/events" class="btn" style="padding: 6px 12px;">‚Üê –í—Å–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</a>
                <#if user??>
                    <a href="${contextPath}/events/my" class="btn" style="padding: 6px 12px;">–ú–æ–∏ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</a>
                </#if>
            </nav>
            <h1>${event.title!''}</h1>
        </div>

        <#if user??>
            <div style="flex-shrink: 0;">
                <#if isOrganizer?? && isOrganizer>
                    <a href="${contextPath}/events/edit/${event.id}" class="btn" style="margin-right: 0.5rem;">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
                    <form action="${contextPath}/events/delete" method="post" style="display: inline;">
                        <input type="hidden" name="id" value="${event.id}">
                        <button type="submit" class="btn" style="background: #e74c3c;" onclick="return confirm('–£–¥–∞–ª–∏—Ç—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ?')">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
                    </form>
                <#else>
                    <#if isRegistered?? && isRegistered>
                        <form action="${contextPath}/events/registration/cancel" method="post" style="display: inline;">
                            <input type="hidden" name="eventId" value="${event.id}">
                            <button type="submit" class="btn" style="background: #e74c3c;">‚ùå –û—Ç–º–µ–Ω–∏—Ç—å –∑–∞–ø–∏—Å—å</button>
                        </form>
                    <#else>
                        <form action="${contextPath}/events/registration" method="post" style="display: inline;">
                            <input type="hidden" name="eventId" value="${event.id}">
                            <button type="submit" class="btn btn-success">‚úÖ –ó–∞–ø–∏—Å–∞—Ç—å—Å—è</button>
                        </form>
                    </#if>
                </#if>
            </div>
        </#if>
    </div>

    <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 2rem;">
        <div class="card">
            <h3>üìã –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–∏</h3>

            <div style="display: grid; grid-template-columns: auto 1fr; gap: 1rem; align-items: start;">
                <strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong>
                <div>${event.description!''}</div>

                <strong>–ú–µ—Å—Ç–æ:</strong>
                <div>${event.location!''}</div>

                <strong>–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è:</strong>
                <div>
                    <#if event.eventDate??>
                        <div style="font-size: 1.1em; font-weight: 500;">
                            ${event.eventDate.toString()}
                        </div>
                    <#else>
                        <span style="color: #dc3545;">–ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞</span>
                    </#if>
                </div>

                <strong>–¢–∏–ø –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è:</strong>
                <div>
                    <#assign eventTypeName = "">
                    <#if event.eventType??>
                        <#assign eventTypeName = event.eventType.name>
                    <#elseif event.eventTypeId?? && eventTypes??>
                        <#list eventTypes as type>
                            <#if type.id == event.eventTypeId>
                                <#assign eventTypeName = type.name>
                                <#break>
                            </#if>
                        </#list>
                    </#if>

                    <#if eventTypeName != "">
                        <span class="badge badge-primary">${eventTypeName}</span>
                    <#elseif event.eventTypeId??>
                        <span class="badge badge-primary">–¢–∏–ø ID: ${event.eventTypeId}</span>
                    <#else>
                        <span class="badge" style="background: #f8f9fa; color: #6c757d;">–ù–µ —É–∫–∞–∑–∞–Ω</span>
                    </#if>
                </div>
            </div>
        </div>

        <div>
            <div class="card" style="margin-bottom: 1rem;">
                <h4>üë§ –û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä</h4>
                <#if event.userId??>
                    <p>ID –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–∞: ${event.userId}</p>
                <#else>
                    <p>–û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä –Ω–µ —É–∫–∞–∑–∞–Ω</p>
                </#if>
            </div>

            <#if user??>
                <div class="card">
                    <h4>üìù –í–∞—à —Å—Ç–∞—Ç—É—Å</h4>
                    <#if isOrganizer?? && isOrganizer>
                        <p style="color: #27ae60; font-weight: 500;">üéØ –í—ã –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä</p>
                        <small>–í—ã –º–æ–∂–µ—Ç–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ —É–ø—Ä–∞–≤–ª—è—Ç—å —ç—Ç–∏–º –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ–º</small>
                    <#elseif isRegistered?? && isRegistered>
                        <p style="color: #3498db; font-weight: 500;">‚úÖ –í—ã –∑–∞–ø–∏—Å–∞–Ω—ã</p>
                        <small>–í—ã —É—á–∞—Å—Ç–≤—É–µ—Ç–µ –≤ —ç—Ç–æ–º –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–∏</small>
                    <#else>
                        <p style="color: #e67e22; font-weight: 500;">‚è≥ –ù–µ –∑–∞–ø–∏—Å–∞–Ω—ã</p>
                        <small>–ù–∞–∂–º–∏—Ç–µ "–ó–∞–ø–∏—Å–∞—Ç—å—Å—è" —á—Ç–æ–±—ã —É—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å</small>
                    </#if>
                </div>
            </#if>
        </div>
    </div>


    <#if !user??>
        <div class="card" style="background: #e3f2fd; border-left: 4px solid #2196F3;">
            <h4>üîê –í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É</h4>
            <p>–ß—Ç–æ–±—ã –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ –∏–ª–∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–≤–æ–∏, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É.</p>
            <a href="${contextPath}/auth/login" class="btn">–í–æ–π—Ç–∏</a>
            <a href="${contextPath}/auth/register" class="btn" style="background: #95a5a6;">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
        </div>
    </#if>
</@layout.base>