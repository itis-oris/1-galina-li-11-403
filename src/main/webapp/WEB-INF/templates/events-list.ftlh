<#import "base.ftlh" as layout>

<@layout.base pageTitle=pageTitle!"–í—Å–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
        <h1>${pageTitle!"–í—Å–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è"}</h1>
        <#if user??>
            <a href="${contextPath}/events/new" class="btn btn-success">+ –°–æ–∑–¥–∞—Ç—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ</a>
        </#if>
    </div>

    <#if eventTypes?? && eventTypes?size gt 0>
        <div class="card mb-2">
            <h3>–§–∏–ª—å—Ç—Ä –ø–æ —Ç–∏–ø—É</h3>
            <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                <a href="${contextPath}/events/filter" class="btn"
                   style="background: <#if !selectedTypeId??>#3498db<#else>#95a5a6</#if>;">
                    –í—Å–µ —Ç–∏–ø—ã
                </a>
                <#list eventTypes as type>
                    <a href="${contextPath}/events/filter?eventTypeId=${type.id}" class="btn"
                       style="background: <#if selectedTypeId?? && selectedTypeId == type.id>#3498db<#else>#95a5a6</#if>;">
                        ${type.name!""}
                    </a>
                </#list>
            </div>
        </div>
    </#if>

    <#if events?? && events?size gt 0>
        <div class="card">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <h3>–ù–∞–π–¥–µ–Ω–æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π: ${events?size}</h3>
            </div>

            <table>
                <thead>
                <tr>
                    <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                    <th>–¢–∏–ø</th>
                    <th>–ú–µ—Å—Ç–æ</th>
                    <th>–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è</th>
                    <th></th>
                </tr>
                </thead>
                <tbody>
                <#list events as event>
                    <tr>
                        <td style="min-width: 200px;">
                            <strong>${event.title!''}</strong>
                            <#if event.description?? && event.description != "">
                                <br>
                                <small style="color: #666;">${event.description}</small>
                            </#if>
                        </td>
                        <td>
                            <#-- –í–ê–†–ò–ê–ù–¢, –ö–û–¢–û–†–´–ô –†–ê–ë–û–¢–ê–õ –†–ê–ù–¨–®–ï -->
                            <#if event.eventType??>
                                <span class="badge badge-primary">${event.eventType.name!""}</span>
                            <#else>

                                <#assign eventTypeName = "">
                                <#if eventTypes?? && event.eventTypeId??>
                                    <#list eventTypes as type>
                                        <#if type.id == event.eventTypeId>
                                            <#assign eventTypeName = type.name>
                                            <#break>
                                        </#if>
                                    </#list>
                                </#if>
                                <span class="badge badge-primary">
                                        <#if eventTypeName != "">
                                            ${eventTypeName}
                                        <#else>
                                            –¢–∏–ø ID: ${event.eventTypeId!0}
                                        </#if>
                                    </span>
                            </#if>
                        </td>
                        <td>${event.location!''}</td>
                        <td style="min-width: 150px;">
                            <#if event.eventDate??>
                                <div style="font-weight: 500;">
                                    ${event.eventDate.toString()}
                                </div>
                            <#else>
                                <span style="color: #dc3545;">–ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞</span>
                            </#if>
                        </td>
                        <td style="min-width: 120px;">
                            <a href="${contextPath}/events/${event.id!}" class="btn" style="padding: 6px 12px; font-size: 0.9em;">
                                –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                            </a>
                        </td>
                    </tr>
                </#list>
                </tbody>
            </table>
        </div>
    <#else>
        <div class="card text-center">
            <div style="padding: 3rem;">
                <div style="font-size: 4rem; margin-bottom: 1rem;">üì≠</div>
                <h3 style="color: #6c757d; margin-bottom: 1rem;">–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h3>
                <#if user??>
                    <p>–ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º, –∫—Ç–æ —Å–æ–∑–¥–∞—Å—Ç –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ!</p>
                    <a href="${contextPath}/events/new" class="btn btn-success mt-2">–°–æ–∑–¥–∞—Ç—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ</a>
                <#else>
                    <p>–í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É, —á—Ç–æ–±—ã —Å–æ–∑–¥–∞–≤–∞—Ç—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</p>
                    <a href="${contextPath}/auth/login" class="btn mt-2">–í–æ–π—Ç–∏</a>
                </#if>
            </div>
        </div>
    </#if>
</@layout.base>